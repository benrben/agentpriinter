# Task: Decide where the component catalog artifact lives + how it’s generated/consumed

## 1. Summary
**Goal**: Decide the concrete artifact location and generation path for the Component Catalog Contract so it can be produced reliably and consumed by the backend (without inventing a second source of truth).
**Context**: Today, the only cross-stack contract artifact is `contracts/schemas.json` generated by the backend; frontend codegen consumes it.

## 2. Current State (Scopes)
- **Anchor Scope**: [Protocol Schema & Codegen](../../Product/Contracts/Protocol_Schema.md)
- **Current Behavior**:
  - Backend exports a schema root (`ProtocolContract`) to `contracts/schemas.json`. [agentprinter-fastapi/scripts/export_schema.py:L25-L66](../../../agentprinter-fastapi/scripts/export_schema.py#L25-L66)
  - `ProtocolContract` fields are backend-defined Pydantic models (message/page/error/resume/etc). [agentprinter-fastapi/scripts/export_schema.py:L25-L44](../../../agentprinter-fastapi/scripts/export_schema.py#L25-L44)
  - Frontend codegen reads `../contracts/schemas.json` to generate TS types + Zod validators. [agentprinter-react/package.json:L21-L23](../../../agentprinter-react/package.json#L21-L23)
  - The component registry (catalog truth source) lives in the frontend runtime. [agentprinter-react/src/renderer.tsx:L1693-L1739](../../../agentprinter-react/src/renderer.tsx#L1693-L1739)

## 3. Desired State
- **New Behavior**:
  - There is a single, documented artifact that represents the Component Catalog Contract and is easy to regenerate (ideally committed alongside other contracts).
  - Backend has a clear consumption mechanism for that artifact (startup load and/or template validation path).
- **Constraints**:
  - **Frontend remains the single source of truth** for catalog contents.
  - Prefer a simple, portable format (JSON) and a simple build step (one command).
  - Avoid coupling the catalog generation to backend schema export if it would force “dual truth” or complex tooling.

## 4. Implementation Steps
1. **Choose the artifact location** (pick one and document it):
   - Option A: `contracts/component_catalog.json` (sibling to `contracts/schemas.json`)
   - Option B: `agentprinter-fastapi/src/agentprinter_fastapi/static/component_catalog.json` (backend-owned copy, generated)
2. **Choose the generator** (pick one and document it):
   - Option A: Frontend script (bun/ts) imports registry and writes JSON.
   - Option B: Node-only “registry scrape” script that reads a curated registry source file.
3. **Define the “generate” command**:
   - Exact command to run and where (repo root vs `agentprinter-react`).
4. **Define the backend consumption contract**:
   - When/where the backend loads the artifact (startup, per-request, per-template load).
   - What happens when the artifact is missing or stale.
5. **Write the decision note under Scopes**:
   - Create `Scopes/Research/2026-02-02-component-catalog-artifact-pipeline.md` documenting:
     - artifact path
     - generation command
     - consumption location
     - “how to keep it fresh” policy

## 5. Acceptance Criteria (Verification)
- [ ] A decision note exists: `Scopes/Research/2026-02-02-component-catalog-artifact-pipeline.md`
  - [ ] Contains chosen artifact location + generation command (verbatim).
  - [ ] Contains chosen backend consumption location (exact module/function to own it).
  - [ ] Includes at least 3 evidence links showing current schema export + frontend codegen pipeline.
- [ ] **Scope Maintenance**:
  - [ ] Update `Scopes/Product/Contracts/Protocol_Schema.md`:
    - Add a short section “Sibling contract artifacts” listing `contracts/schemas.json` and the chosen catalog artifact path.
    - Keep diagrams at exactly **2**.
  - [ ] Update `Scopes/DEVELOPER_INFO.md` if you introduce a new standard command (e.g., “Generate component catalog”).

## 6. Dependencies
- [ ] Task: [Define the one-way “Component Catalog Contract” (frontend registry → backend)](./2026-02-02-01-one-way-component-catalog-contract.md)
- [ ] Task: [Decide backend policy for unknown component types (consume the catalog)](./2026-02-02-02-backend-consume-component-catalog-policy.md)

## Audit Checklist
- [ ] Anchor Scope path is under `Scopes/Product/**`
- [ ] Decision is executable (exact command, exact output path, exact owner module)
- [ ] Evidence links show the current pipeline (export + codegen)

